{"version":3,"file":"vue.js","sources":["../src/observe/index.js","../src/state.js","../src/init.js","../src/index.js"],"sourcesContent":["class Observer {\n  constructor(data) {\n    // Object.defineProperty 只能劫持存在的属性，新增的 删除的检测不到\n\n    this.walk(data);\n  }\n\n  walk(data) {\n    // ”重新定义“ 属性 vue2 的性能瓶颈\n    Object.keys(data).forEach((key) => defineReactive(data, key, data[key]));\n  }\n}\n/**\n * 属性劫持\n * @param {*} target\n * @param {*} key\n * @param {*} val\n */\nexport function defineReactive(target, key, val) {\n  // 递归深度劫持\n  observe(val);\n  // 闭包 会将 val 存在 defineReactive 这个作用域里\n  Object.defineProperty(target, key, {\n    get() {\n      return val;\n    },\n    set(newVal) {\n      if (newVal === val) return;\n      // 当重新赋值时，新值也要进行劫持\n      observe(newVal);\n      val = newVal;\n    },\n  });\n}\n\nexport function observe(data) {\n  // 仅仅对对象进行劫持\n  if (data === null || typeof data !== \"object\") {\n    return;\n  }\n\n  return new Observer(data);\n}\n","import { observe } from \"./observe/index\";\n\nfunction initState(vm) {\n  const opts = vm.$options;\n  if (opts.data) {\n    initData(vm);\n  }\n}\n\n// 代理取值 vm.name => vm._data.name\nfunction proxy(vm, target, key) {\n  Object.defineProperty(vm, key, {\n    get() {\n      return vm[target][key];\n    },\n    set(nv) {\n      vm[target][key] = nv;\n    },\n  });\n}\n\nfunction initData(vm) {\n  let data = vm.$options.data;\n\n  // vue 根实例的 data 可以是对象、函数。 组件里的 data 必须是函数\n  data = typeof data === \"function\" ? data.call(vm) : data;\n\n  vm._data = data;\n\n  // 数据劫持 defineProperty\n  observe(data);\n\n  for (const key in data) {\n    proxy(vm, \"_data\", key);\n  }\n}\n\nexport { initState };\n","import { initState } from \"./state\";\n\nexport function initMixin(Vue) {\n  Vue.prototype._init = function (options) {\n    // $ 开头的都认为是自己的属性，data 里设置 $name $age 会不生效\n    const vm = this;\n    // 将配置挂载到实例上 方便其他方法访问\n    vm.$options = options;\n\n    initState(vm);\n  };\n}\n","import { initMixin } from \"./init\";\n\nfunction Vue(options) {\n  this._init(options);\n}\n\ninitMixin(Vue);\n\nexport default Vue;\n"],"names":["Observer","data","walk","Object","keys","forEach","key","defineReactive","target","val","observe","defineProperty","get","set","newVal","initState","vm","opts","$options","initData","proxy","nv","call","_data","initMixin","Vue","prototype","_init","options"],"mappings":"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"}